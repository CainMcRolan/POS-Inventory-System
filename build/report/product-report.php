<?php
require '../../fpdf/fpdf.php';
require '../../helper/connect.php';

session_start();

// Determine the date to use
date_default_timezone_set('Asia/Manila');
$date = isset($_SESSION['$selected_date']) ? $_SESSION['$selected_date'] : date('Y-m-d');
$startOfDay = $date . ' 00:00:00';
$endOfDay = $date . ' 23:59:59';

// Fetch product data
$query = "SELECT * FROM product";
$result = mysqli_query($connection, $query);

$pdf = new FPDF('P', 'mm', array(83, 55)); // Adjusted width and height for vertical orientation

$pdf->SetMargins(5, 5, 2); // Set margins
$pdf->SetAutoPageBreak(true, 5.00);

$pdf->AddPage();

// Title
$pdf->SetFont('Arial', 'B', 6);
$pdf->Cell(0, 2, 'CRT Minimart Product Report', 0, 1, 'C');
$pdf->Ln(1);

// Date and time
$pdf->SetFont('Arial', '', 5);
$pdf->Cell(0, 2, 'Date: ' . $date, 0, 1, 'C');
$pdf->Cell(0, 2, 'Time: ' . date('H:i:s'), 0, 1, 'C');
$pdf->Cell(0, 2, 'Report Generated by: Admin', 0, 1, 'C');
$pdf->Ln(1);

// Table headers
$pdf->SetFont('Arial', 'B', 5);
$pdf->Cell(0, 2, 'Product Report:', 0, 1, 'C');

// Fetch product data
$query = "SELECT * FROM product";
$result = mysqli_query($connection, $query);

// Table data
$pdf->SetFont('Arial', '', 5);
while ($row = mysqli_fetch_assoc($result)) {
    // Output product details
    $pdf->Cell(15, 2, 'Product Code:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['code'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Name:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['name'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Category:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['category'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Price:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['price'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Stock:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['current_stock'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Physical Count:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['physical_count'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Delivery:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['delivery'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Transfer:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['transfer'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Wasteges:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['wasteges'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Pull Out:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['pull_out'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Returns:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['returns'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Variance:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['variance'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Description:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['description'], 0, 1, 'R');
    $pdf->Cell(15, 2, 'Date Added:', 0, 0, 'L');
    $pdf->Cell(30, 2, $row['date_added'], 0, 1, 'R');

    $pdf->Cell(0, 2, str_repeat('.', 88), 0, 1, 'L');
    $pdf->Ln(1);
}

// Thank you message
$pdf->SetFont('Arial', 'I', 4);
$pdf->Cell(0, 2, 'Thank you for your hard work!', 0, 1, 'C');
$pdf->Cell(0, 2, 'For inquiries, contact: +956-143-4976', 0, 1, 'C');
$pdf->Ln(1);

$pdf->Output('I', 'Product_Report' . $date . '.pdf');
?>
